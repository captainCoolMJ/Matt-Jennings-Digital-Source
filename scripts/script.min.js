/*! matt-jennings-digital 2016-06-11 */
!function(){"use strict";function a(a){if(a.value.length>0)if("email"===a.fieldName){for(var b,c,d,e=a.value,f=" /:,;",g=0;g<f.length;g++)if(b=f.charAt(g),e.indexOf(b,0)>-1)return!1;if(c=e.indexOf("@",1),-1==c)return!1;if(-1!=e.indexOf("@",c+1))return!1;if(d=e.indexOf(".",c),-1==d)return!1;if(d+3>e.length)return!1;a.valid=!0}else a.valid=!0;else a.valid=!1}function b(){var b=[],c=$("<ul>"),d=$(".form-contact").css("height"),e=$('<div class="loaderDiv">').css({height:d});$(".form-contact").css("height",d).append(e),$(".form-contact .form-required").each(function(a,c){var d={fieldName:$(c).attr("name"),text:$(c).attr("id").replace("form-",""),value:$(c).val(),valid:!1};b.push(d)}),b.map(a);var f=b.filter(function(a){return a.valid===!1});if(f.length)$(".form-contact").css("height","auto"),e.remove(),f.forEach(function(a){var b=$("<li>"),d=a.text.toLowerCase(),e="Please enter valid "+d;b.text(e),c.append(b)}),$(".form-error").html(c);else{var g=b.map(function(a){var b=encodeURIComponent(a.fieldName)+"="+encodeURIComponent(a.value);return b}),h=g.join("&");$(".form-contact input, .form-contact textarea").attr("disabled",!0),$(".form-error").text(""),$.ajax({type:"POST",data:h,dataType:"json",url:"scripts/sendmail.php",success:function(a){$(".form-contact").html("<p>"+a.msg+"</p>"),$(".form-text").remove()},error:function(a){$(".form-contact").html('<p>There has been an error. Please <a href="mailto:matt@mattjenningsdigital.com" title="Send us an email">send me an email</a> instead.</p><p>'+a.status+": "+a.statusText+"</p>"),$(".form-text").remove()},complete:function(){e.remove(),$(".form-contact input, .form-contact textarea").attr("disabled",!1)}})}}var c=new Date,d=c.getFullYear("yyyy"),e=document.getElementById("date");e.innerHTML=d;var f=function(){setTimeout(function(){$(".timeline-evt").addClass("active")},1e3)},g=function(a,b,c){a.hover(function(){b.addClass(c)},function(){b.removeClass(c)})},h=function(a){var b=function(a){var b=new Date(a),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=c[b.getMonth()],e=b.getFullYear(),f=Date.parse(b);return{ms:f,formatted:d+" "+e}},c=function(a){this.start=b(a.from),this.end=b("present"!==a.to.toLowerCase()?a.to:Date.now()),this.duration=this.end.ms-this.start.ms,this.evt=a.action,this.cat=a.category,this.details=a.details,this.$timelinePlot=$('<div class="timeline-evt">')};c.prototype.build=function(a,c){if(this.end.ms<c)return!1;var d=Date.now()-c,e=Math.round(this.duration/d*100),f=Math.round((this.start.ms-c)/d*100);b(Date.now()).ms===this.end.ms&&(this.end.formatted="Present");var g=$('<div class="time-evt-description">'),h=$('<h4 class="plot-title">').text(this.evt),i=$('<p class="plot-date">').text(this.start.formatted+" - "+this.end.formatted),j=$('<p class="plot-details">').text(this.details);return e=e>100?100:e,f=0>f?0:f,this.$timelinePlot.addClass("timeline-"+this.cat),g.append(h).append(i).append(j),this.addEventListeners(),this.$timelinePlot.append(g),this.$timelinePlot},c.prototype.addEventListeners=function(){this.$timelinePlot.hover(function(){$(this).toggleClass("hover")})};var d=function(){var b=[];a.forEach(function(a){var d=new c(a);b.push(d)}),b.sort(function(a,b){return b.start.ms-a.start.ms});var d=31556925974,e=Date.now()-8*d,f=b.filter(function(a){return"work"===a.cat}),g=b.filter(function(a){return"life"===a.cat}),h=$("#timeline-work"),i=$("#timeline-life");f.forEach(function(a,b){h.append(a.build(b,e))}),g.forEach(function(a,b){i.append(a.build(b,e))})};return{init:d()}};$("a[href*=#]:not([href=#])").click(function(a){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var b=$(this.hash);b=b.length?b:$("[name="+this.hash.slice(1)+"]"),b.length&&($("html,body").stop().animate({scrollTop:b.offset().top},350,"easeInOutQuart"),a.preventDefault())}}),$(document).ready(function(){$.getJSON("data/site.json",function(a){h(a.timeline)}),g($(".title, .logo"),$(".logo"),"hover"),g($("header, .main_nav"),$("header"),"hover"),f(),$("#toggleMenu").on("click",function(){return $("body").addClass("menu-active"),$("body").one("click",function(){$("body").removeClass("menu-active")}),!1});({left:Math.round($(".timelines").offset().left),top:Math.round($(".timelines").offset().top),right:Math.round($(".timelines").offset().left+$(".timelines").outerWidth()),bottom:Math.round($(".timelines").offset().top+$(".timelines").outerHeight())});$(".form-contact .form-submit").click(function(a){a.preventDefault(),b()})})}($);